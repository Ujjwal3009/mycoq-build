#!/bin/bash

# mycoq - CLI wrapper for mycoq-build
# This script allows you to run: mycoq build, mycoq list, etc.

# Get the directory where this script is located
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Path to the JAR file
JAR_FILE="$SCRIPT_DIR/target/mycoq-build-1.0-SNAPSHOT.jar"

# Path to classpath file
CLASSPATH_FILE="$SCRIPT_DIR/classpath.txt"

# Check if JAR exists
if [ ! -f "$JAR_FILE" ]; then
    echo "Error: JAR file not found at $JAR_FILE"
    echo "Please run 'mvn clean package' first"
    exit 1
fi

# Check if classpath file exists, if not generate it
if [ ! -f "$CLASSPATH_FILE" ]; then
    echo "Generating classpath file..."
    cd "$SCRIPT_DIR"
    mvn dependency:build-classpath -Dmdep.outputFile=classpath.txt -q
    if [ $? -ne 0 ]; then
        echo "Error: Failed to generate classpath"
        exit 1
    fi
fi

# Read classpath
CLASSPATH=$(cat "$CLASSPATH_FILE")

# Run the CLI with all arguments passed through
java -cp "$JAR_FILE:$CLASSPATH" org.example.Main "$@"
